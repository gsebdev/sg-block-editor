/*! For license information please see index.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports["sg-block-editor"]=t(require("react")):e["sg-block-editor"]=t(e.react)}(this,(e=>(()=>{"use strict";var t={20:(e,t,r)=>{var o=r(155),n=Symbol.for("react.element"),c=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),l=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,r){var o,a={},s=null,d=null;for(o in void 0!==r&&(s=""+r),void 0!==t.key&&(s=""+t.key),void 0!==t.ref&&(d=t.ref),t)c.call(t,o)&&!i.hasOwnProperty(o)&&(a[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===a[o]&&(a[o]=t[o]);return{$$typeof:n,type:e,key:s,ref:d,props:a,_owner:l.current}}},848:(e,t,r)=>{e.exports=r(20)},155:t=>{t.exports=e}},r={};function o(e){var n=r[e];if(void 0!==n)return n.exports;var c=r[e]={exports:{}};return t[e](c,c.exports,o),c.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};o.r(n),o.d(n,{default:()=>d});var c=o(848),l=o(155);const i=()=>"_"+Math.random().toString(36).substr(2,9),a={isDirty:!1,setIsDirty:()=>{},blocks:new Map,setBlocks:()=>{},addBlock:()=>{},updateBlock:()=>{},deleteBlock:()=>{},activeBlock:null,setActiveBlock:()=>{}},s=(0,l.createContext)(a);(0,l.forwardRef)((({children:e,data:t,onChange:r},o)=>{const[n,a]=(0,l.useState)(new Map),[d,u]=(0,l.useState)(t),[p,f]=(0,l.useState)(!1),[h,y]=(0,l.useState)(null);(0,l.useImperativeHandle)(o,(()=>({getRenderedValue:()=>null!=d?d:[]})));const v=(0,l.useCallback)(((e,t,r)=>{a((r=>{const o=new Map(r),n=o.get(e);return n?(o.set(e,Object.assign(Object.assign({},n),t)),o):o})),r||f(!0)}),[]);(0,l.useEffect)((()=>{var e;const t=[];if(h){const r=null===(e=n.get(h))||void 0===e?void 0:e.parentID;let o=r?n.get(r):void 0;for(;o;)t.push(o.blockID),o=o.parentID?n.get(o.parentID):void 0}n.forEach((e=>{t.includes(e.blockID)?e.hasFocusWithin||v(e.blockID,{hasFocusWithin:!0},!0):e.hasFocusWithin&&v(e.blockID,{hasFocusWithin:!1},!0)}))}),[h,v,n]),(0,l.useEffect)((()=>{if(u(t),t){const e=new Map,r=(t,o)=>{const n=i();if(t.children&&Array.isArray(t.children)){const c=Object.assign(Object.assign({},t),{blockID:n,parentID:o,children:[]});c.children=t.children.map((e=>r(e,n))),e.set(n,c)}else e.set(n,Object.assign(Object.assign({},t),{blockID:n,parentID:o,children:void 0}));return n};t.forEach((e=>r(e))),a(e)}}),[t]),(0,l.useEffect)((()=>{if(p){const e=t=>t.children&&Array.isArray(t.children)?{type:t.type,value:t.value,children:t.children.map((t=>{const r=n.get(t);return r?e(r):{type:"text",value:"[ERROR] Block not found"}}))}:{type:t.type,value:t.value},t=Array.from(n.values()).filter((e=>!e.parentID)).map((t=>e(t)));u(t),r&&r(t),f(!1)}}),[p,n,r]);const b=(0,l.useCallback)(((e,t)=>{const r=i(),{parentID:o,position:n,reference:c}=null!=t?t:{};a((t=>{var l;const i=Array.from(t);let a=i.length;if(c&&(a=i.findIndex((([e,t])=>e===c)),"after"===n&&(a+=1)),i.splice(a,0,[r,{type:e,value:"text"===e?"<p>Bloc de texte<p>":void 0,blockID:r,parentID:o,children:"group"===e?[]:void 0}]),o){const e=null===(l=i.find((([e,t])=>e===o)))||void 0===l?void 0:l[1];if(e&&Array.isArray(e.children)&&!e.children.includes(r)){let t=e.children.length;c&&(t=e.children.findIndex((e=>e===c)),"after"===n&&(t+=1)),e.children.splice(t,0,r)}}return new Map(i)})),y(r),f(!0)}),[]),k=(0,l.useCallback)((e=>{let t=null;a((r=>{const o=new Map(r),n=o.get(e);if(!n)return o;(null==n?void 0:n.parentID)&&(t=n.parentID);const c=[],l=e=>{const t=o.get(e);if(t&&t.children&&Array.isArray(t.children))for(const e of t.children)l(e);c.push(e)};return l(e),(()=>{if(n&&n.parentID){const t=o.get(n.parentID);t&&t.children&&(t.children=t.children.filter((t=>t!==e)))}})(),c.forEach((e=>o.delete(e))),o})),y(t),f(!0)}),[]);return(0,c.jsx)(s.Provider,{value:{blocks:n,setBlocks:a,isDirty:p,setIsDirty:f,addBlock:b,updateBlock:v,deleteBlock:k,activeBlock:h,setActiveBlock:y},children:e})})).displayName="BlocksEditorContextProvider";const d=()=>(0,l.useContext)(s);return n})()));